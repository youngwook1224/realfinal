<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
      layout:decorate="/layout/layout">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <style type="text/css">
    body {
      background-color: #212529;
      color: #f8f9fa;
    }
    .card {
      background-color: #343a40;
    }
    .card-title, .card-text {
      color: #f8f9fa;
    }
    .blockquote {
      color: #f8f9fa;
    }
    header {
      padding: 1rem 0;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav a {
      color: #f8f9fa;
      margin-right: 1rem;
    }
    .nav-right {
      display: flex;
      align-items: center;
    }
    .nav-right input[type="search"] {
      margin-right: 1rem;
      padding: 0.5rem;
    }
    .sign-up {
      background-color: #007bff;
      color: #f8f9fa;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    .menu {
      display: flex;
      flex-wrap: wrap;
      margin: 1rem 0;
    }
    .menu a {
      color: #f8f9fa;
      margin-right: 1rem;
      padding: 0.5rem 0;
    }
    .menu li{
      list-style-type: none;
      display: inline-block;
    }
    .featured-post {
      margin-bottom: 2rem;
    }
    .post-previews {
      display: flex;
      justify-content: space-between;
    }
    .post-preview {
      background-color: #343a40;
      padding: 1rem;
      margin-right: 1rem;
      flex: 1;
    }
    a {
      text-decoration: none;
      color:black;
    }
    a:hover {
      text-decoration: underline;
    }
    .target {
      color:red;
      font-weight: bold;
      font-size: 1.5em;
    }
    .noLine {
      color:black;
      font-weight: normal;
      font-size:1em;
    }
  </style>


    <style>


      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        margin: 0 auto;
      }
      .slider {
        border: 1px solid #5000;
        overflow: hidden;
        position: relative;
        width: 570px;
        margin: 0 auto;
        background: #ffffff;
        box-shadow: 3px 2px 2px #dcdcdc;
        border-radius: 25px;
        color: black;
      }
      .slider .inner {
        overflow: hidden;
        margin: 0 auto;
      }
      .slide_list{
        overflow: hidden;
        width: 1700px;
        position: relative;
        display: flex; /* Flexbox 사용 */
      }
      .slider .btn {
        position: absolute;
        top: 50%;
        width: 35px;
        height: 35px;
        background-size: cover;
        cursor: pointer;
      }
      .slider .btn.btn_prev {
        left: 0;
        transform: translate(0,-50%);
      }
      .slider .btn.btn_next {
        right:0;
        transform: translate(0,-50%);
      }

      #time-slots, #seatdiv, #caldiv {
        margin: auto 0;
        padding: 50px;
        width: 100%;
        height: 570px;
        font-size: 20px;
        text-align: center;
      }


    </style>
    <style>
      /*캘린더*/

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin-top: 20px;
      }
      .day {
        padding: 15px;
        border: none;
        text-align: center;
        cursor: pointer;
        background-color: #dcdcdc;
        border-radius: 50%;
      }
      .day.selected {
        background-color: #ffa500;
        color: white;
        border: 2px solid #212529;
      }
      .week{
        border-bottom: 1px #212529 solid;
        text-align: center;
        font-weight: bold;
        font-size: 1.2em;

      }
      #selected-date {
        margin-top: 20px;
        font-weight: bold;
      }
      .month-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .month-header button {
        cursor: pointer;
        padding: 5px 10px;
        font-size: 16px;
      }

      #prev-month{
        border: none;
        background-color: #ffa500;
        border-radius: 50%;
      }
      #next-month{
        border: none;
        background-color: #ffa500;
        border-radius: 50%;
      }

    </style>
  <style>

    /*좌석*/
    .seating-chart {
      display: grid;
      grid-template-areas:
            "left-corner center right-corner"
            "bottom-corner bottom-corner bottom-corner";
      gap: 20px;
      margin-top: 20px;
    }
    .zone {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .left-corner {
      grid-area: left-corner;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-right: 40px;
      gap: 10px;
    }
    .right-corner {
      grid-area: right-corner;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
      margin-left: 40px;
    }
    .bottom-corner {
      grid-area: bottom-corner;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .center div {
      margin: 5px;
    }
    #center2 {
      border-bottom: 3px solid #343a40;
    }
    .seat {
      width: 40px;
      height: 40px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #90ee90;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s;
    }
    .seat.unavailable {
      background-color: #ffcccb;
      cursor: not-allowed;
    }
    .seat.selected {
      background-color: #ffa500;
      transform: scale(1.1);
    }
    #seat-submit-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    #submit-btn:hover {
      background-color: #45a049;
    }
    /*인원수 책정*/
    #respeople {
      margin: auto 0;
    }
    .peopleP {
      display: inline-block;
      width: 50px;
      text-align: center;
    }
    #respeople button {
      font-weight: bold;
      border: none;
      width: 30px;
      height: 30px;
      background-color: rgba(230,230,230,0.7);
      border-radius: 15px;
    }

  </style>


  <style>
    /*시간*/
    .time-slot {
      margin: 10px 0;
      display: inline-block;
    }
    .selected {
      background-color: #ffa500;
      color: white;
      font-weight: bold;
    }
    .time-button{
      border: 1px black solid;
      background-color: greenyellow;
      border-radius: 10px;
      width: 70px;
      height: 50px;
    }
    /*버튼 고쳐라*/
    #submit-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
  </style>

  <script>
    //캘린더
    $(document).ready(function() {
      const today = new Date();
      let currentYear = today.getFullYear();
      let currentMonth = today.getMonth();
      let choice = false;

      function renderCalendar(year, month) {
        $('#calendar').empty();

        // 날짜 객체 생성
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const totalDays = lastDay.getDate();

        // 달력 헤더에 월과 연도 표시
        $('#month-year').text(`${year}년 ${month + 1}월`);

        // 요일 표시 (일요일부터 시작)
        const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
        for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
          $('#calendar').append(`<div class="week">${weekdays[dayOfWeek]}</div>`);
        }

        // 월의 첫날이 무슨 요일인지 계산 (0: 일요일, 1: 월요일, ..., 6: 토요일)
        const startDayOfWeek = firstDay.getDay();

        // 빈 칸 채우기
        for (let i = 0; i < startDayOfWeek; i++) {
          $('#calendar').append('<div class="day"></div>');
        }

        // 월의 첫날부터 마지막날까지 날짜 표시
        for (let day = 1; day <= totalDays; day++) {
          const date = new Date(year, month, day);
          const isFutureDate = date >= today;

          const dayDiv = $('<div class="day"></div>')
                  .text(day)
                  .data('date', date.toISOString().split('T')[0]); // YYYY-MM-DD 포맷

          if (isFutureDate) {
            dayDiv.css('cursor', 'pointer');
          } else {
            dayDiv.css('color', '#ccc'); // 오늘 이전 날짜 비활성화
          }

          dayDiv.click(function () {
            if (isFutureDate) {
              $('.day').removeClass('selected');
              $(this).addClass('selected');
              $('#selected-date').text('선택한 날짜: ' + $(this).data('date'));
              choice = true;
            }
          });

          $('#calendar').append(dayDiv);
        }
      }


      // 이번 달 달력 렌더링
      renderCalendar(currentYear, currentMonth);

      // 다음 달로 이동
      $('#next-month').click(function () {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
      });

      // 이전 달로 이동
      $('#prev-month').click(function () {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar(currentYear, currentMonth);
      });


      //자리


      let count = 1; // 초기값 1명

      // 이미 예약된 좌석 설정
      const unavailableSeats = [];    // 타임리프로 예약된 자리번호 가져와야 함
      unavailableSeats.forEach(function (seatNumber) {
        $(`.seat:contains(${seatNumber})`).addClass('unavailable');
      });


      // 좌석 클릭 시
      $('.seating-chart').on('click', '.seat', function () {
        if (!$(this).hasClass('unavailable')) {
          const selectedSeats = $('.seat.selected').map(function () {
            return $(this).text().trim(); // 선택된 좌석 번호 가져오기
          }).get();

          // 선택된 좌석 수가 인원 수와 맞지 않는 경우에만 선택 가능
          if (selectedSeats.length < count || $(this).hasClass('selected')) {
            $(this).toggleClass('selected');

            // 좌석 선택 상태를 업데이트한 후 다시 선택된 좌석 수를 확인
            const updatedSelectedSeats = $('.seat.selected').map(function () {
              return $(this).text().trim(); // 선택된 좌석 번호 가져오기
            }).get();

            // 선택된 좌석 수가 인원 수와 맞는 경우 choice를 true로 설정
            if (updatedSelectedSeats.length === count) {
              choice = true;
            } else {
              choice = false;
            }
          }
        }
      });


      // 인원 선택 기능
      $("#respeople button").on('click', function () {
        if ($(this).hasClass("down")) {
          if (count <= 1) {
            alert("1명 이하로 인원수를 정할 수 없습니다.");
            return false;
          }
          count--;
        } else if ($(this).hasClass("up")) {
          if (count >= 31) {
            alert("32인 이상은 수용 불가능 합니다.");
            return false;
          }
          count++;
        }
        $('.people').text(count + '인');
      });


      //시간
      // 시간 버튼 클릭 이벤트
      $('.time-button').click(function () {
        // 기존에 선택된 버튼 해제
        $('.time-button.selected').removeClass('selected');
        // 클릭한 버튼 선택
        $(this).addClass('selected');
      });


      //슬라이드 기능


      let index = 0;
      let sw = false;
      let auto;
      let pindex;
      moveSlier(index);   // 웹 열자마자 무브슬라이더(사용자함수) 함수 자동으로 수행하기 위함
      //autoSlider();       //  웹 열자마자 오토 슬라이더(사용자함수) 함수 자동으로 수행하기 위함

      //이미지페이저 이벤트
      /* $('.btn').click(function () {
          pindex = $(this).index();
          moveSlier(pindex)
        })
        //컨트롤 버튼 클릭이벤트
        $('.control_button').click(function () {
          index = $(this).index();
          moveSlier(index);
        });*/
      //좌우 컨트롤 버튼 패널 이벤트

      $('.btn_prev').click(function () {
        /* if(index==0){
             index = 5
         }else*/

        index--;
        moveSlier(index);
        //}
      })
      $('.btn_next').click(function () {
        /*  if(index==4){
              index = -1
          }else{*/
        if (choice) {
          index++;
          moveSlier(index);
        } else {
          alert("예약 내용을 선택하신후 진행하실수 있습니다.")
        }
        //}
      })

      //이미지 슬라이드 구현함수
      function moveSlier(index) {
        if (index < 3 && index > 0) {
          $('.btn_prev').fadeIn('normal');
          $('.btn_next').fadeIn('normal');
        }
        if (index == 2) {
          $('.btn_next').fadeOut('normal');
          $('.btn_prev').fadeIn('normal');
        }
        if (index == 0) {
          $('.btn_prev').fadeOut('normal');
          $('.btn_next').fadeIn('normal');
        }


        $('.slide_list').animate({
          left: -(index * 570)
        }, '500', function () {
          choice = false;
        });
      }//moveslider 끝!

















      // 예약 서밋

      let selectedDate = '';
      let selectedSeats = [];

      $('#submit-btn').click(function () {
        const selectedTime = $('.time-button.selected').data('time');
        selectedDate = $('.day.selected').data('date');
        selectedSeats = $('.seat.selected').map(function () {
          return $(this).text().trim();
        }).get();

        if (selectedTime && selectedSeats.length > 0) {
          // 예약 확인 모달 표시
          confirmModal();
        } else {
          alert('시간과 좌석을 선택하세요.');
        }
      });

      function confirmModal() {
        if (window.confirm("예약날짜: " + selectedDate + "\n예약자리: " + selectedSeats.join(', ') +
                "\n예약시간: " + $('.time-button.selected').text() + "\n\n예약을 확정하시겠습니까?")) {
          // 사용자가 확인을 눌렀을 때 Ajax 요청 실행
          executeReservation();
        }
      }

      function executeReservation() {
        $.ajax({
          url: '/your-mapping-url', // 매핑주소를 여기에 적으세요
          type: 'POST', // 메소드 타입을 여기에 적으세요
          contentType: 'application/json',
          data: JSON.stringify({
            selectedSeats: selectedSeats,
            selectedTime: $('.time-button.selected').data('time'),
            selectedDate: selectedDate
          }),
          success: function (data) {
            if (data.success) {
              alert('좌석이 성공적으로 예약되었습니다!');
              selectedSeats.forEach(function (id) {
                const seat = $(`.seat:contains(${id})`);
                seat.removeClass('selected').addClass('unavailable');
              });
            } else {
              alert('좌석 예약에 실패했습니다.');
            }
          },
          error: function () {
            alert('서버 오류가 발생했습니다. 잠시 후 다시 시도하세요.');
          }
        });
      }
    })


  </script>





</head>
<body>
<th:block layout:fragment="content">
    <div class="slider">
        <div class="inner">
          <div class="swiper-wrapper slide_list">
            <!--캘린더-->
            <div id="caldiv" class="swiper-slide Swiper">
              <h3>예약날짜를 선택해주세요</h3>
              <div class="month-header">
                <button id="prev-month">◀</button>
                <h2 id="month-year"></h2>
                <button id="next-month">▶</button>
              </div>
              <div id="calendar" class="calendar"></div>
              <div id="selected-date"></div>
            </div>

            <!--좌석선택-->
            <div id="seatdiv" class="swiper-slide Swiper">
              <h3>인원 및 좌석을 선택해주세요</h3>
              <div id="respeople">
                <button class="down">-</button>
                <p class="peopleP"><span class="people">1인</span></p>
                <button class="up">+</button>
              </div>
              <div class="seating-chart">
                <div class="zone left-corner">
                  <div class="seat">1</div>
                  <div class="seat">2</div>
                  <div class="seat">3</div>
                  <div class="seat">4</div>
                  <div class="seat">5</div>
                </div>
                <div class="center">
                  <div class="zone" id="center1">
                    <div class="seat">6</div>
                    <div class="seat">7</div>
                    <div class="seat">8</div>
                    <div class="seat">9</div>
                  </div>
                  <div class="zone" id="center2">
                    <div class="seat">10</div>
                    <div class="seat">11</div>
                    <div class="seat">12</div>
                    <div class="seat">13</div>
                  </div>
                  <div class="zone" id="center3">
                    <div class="seat">14</div>
                    <div class="seat">15</div>
                    <div class="seat">16</div>
                    <div class="seat">17</div>
                  </div>
                  <div class="zone" id="center4">
                    <div class="seat">18</div>
                    <div class="seat">19</div>
                    <div class="seat">20</div>
                    <div class="seat">21</div>
                  </div>
                </div>
                <div class="zone right-corner">
                  <div class="seat">22</div>
                  <div class="seat">23</div>
                  <div class="seat">24</div>
                  <div class="seat">25</div>
                  <div class="seat">26</div>
                </div>
                <div class="zone bottom-corner">
                  <div class="seat">27</div>
                  <div class="seat">28</div>
                  <div class="seat">29</div>
                  <div class="seat">30</div>
                  <div class="seat">31</div>
                </div>
              </div>
            </div>


            <!--시간선택 -->
            <div id="time-slots"  class="swiper-slide Swiper">
              <h3>예약시간을 선택해주세요</h3>
              <fieldset>
                <legend>오전</legend>
                <div class="time-slot"><button class="time-button" data-time="08:00">08:00</button></div>
                <div class="time-slot"><button class="time-button" data-time="10:00">10:00</button></div>
                <div class="time-slot"><button class="time-button" data-time="12:00">12:00</button></div>
              </fieldset>
              <fieldset>
                <legend>오후</legend>
                <div class="time-slot"><button class="time-button" data-time="14:00">14:00</button></div>
                <div class="time-slot"><button class="time-button" data-time="16:00">16:00</button></div>
                <div class="time-slot"><button class="time-button" data-time="18:00">18:00</button></div>
              </fieldset>
              <button id="submit-btn">예약</button>
            </div>
          </div>
          <img th:src="@{/images/left_arrow.png}" class="btn btn_prev" alt="앞 페이지">
          <img th:src="@{/images/right_arrow.png}" class="btn btn_next" alt="뒷 페이지">
      </div>
    </div>
</th:block>
</body>
</html>